{% extends "base.html" %}

{% block content %}
<!-- –î–æ–¥–∞—î–º–æ –≤—ñ–¥—Å—Ç—É–ø –∑–≤–µ—Ä—Ö—É –∑–∞–º—ñ—Å—Ç—å –ø–æ–¥–≤—ñ–π–Ω–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ -->
<div class="mt-4 pt-3"></div>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>üè† –ü–∞–Ω–µ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
    <div class="text-muted">
        <i class="bi bi-clock"></i> –û–Ω–æ–≤–ª–µ–Ω–æ: {{ current_time.strftime('%d.%m.%Y %H:%M') if current_time else '–ó–∞—Ä–∞–∑' }}
    </div>
</div>

<div class="row">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                            –£—á–Ω—ñ
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ stats.students }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="bi bi-people fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                            –í—á–∏—Ç–µ–ª—ñ
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ stats.teachers }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="bi bi-person-badge fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                            –ì—É—Ä—Ç–∫–∏
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ stats.clubs }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="bi bi-collection fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                            –ê–∫—Ç–∏–≤–Ω—ñ –∑–∞–Ω—è—Ç—Ç—è
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ stats.schedules }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="bi bi-calendar3 fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-6 mb-4">
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">–®–≤–∏–¥–∫—ñ –¥—ñ—ó</h6>
            </div>
            <div class="card-body">
                <div class="list-group">
                    <a href="/admin/students" class="list-group-item list-group-item-action">
                        <i class="bi bi-plus-circle"></i>
                        –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ —É—á–Ω—è
                    </a>
                    <a href="/admin/teachers" class="list-group-item list-group-item-action">
                        <i class="bi bi-person-plus"></i>
                        –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ –≤—á–∏—Ç–µ–ª—è
                    </a>
                    <a href="/admin/clubs" class="list-group-item list-group-item-action">
                        <i class="bi bi-plus-square"></i>
                        –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –≥—É—Ä—Ç–æ–∫
                    </a>
                    <a href="/admin/attendance" class="list-group-item list-group-item-action">
                        <i class="bi bi-check2-square"></i>
                        –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-6 mb-4">
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">–û—Å—Ç–∞–Ω–Ω—ñ –¥—ñ—ó</h6>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <i class="bi bi-info-circle fa-2x text-gray-300 mb-3"></i>
                    <p class="text-muted">–¢—É—Ç –±—É–¥—É—Ç—å –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—è –æ—Å—Ç–∞–Ω–Ω—ñ –¥—ñ—ó –≤ —Å–∏—Å—Ç–µ–º—ñ</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- üìä –°–ï–ö–¶–Ü–Ø –ó 10 –ö–†–ê–°–ò–í–ò–ú–ò –î–Ü–ê–ì–†–ê–ú–ê–ú–ò -->
<div class="row mt-5">
    <div class="col-12">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="bi bi-bar-chart-fill"></i> üìä –ó–≤—ñ—Ç–∏ —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞
                </h6>
                <button class="btn btn-sm btn-outline-primary" onclick="refreshAllCharts()">
                    <i class="bi bi-arrow-clockwise"></i> –û–Ω–æ–≤–∏—Ç–∏ –≤—Å—ñ –¥—ñ–∞–≥—Ä–∞–º–∏
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –†—è–¥ 1: –ö—Ä—É–≥–æ–≤—ñ –¥—ñ–∞–≥—Ä–∞–º–∏ -->
<div class="row">
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="bi bi-pie-chart-fill"></i> üéØ –†–æ–∑–ø–æ–¥—ñ–ª —É—á–Ω—ñ–≤ –ø–æ –≥—É—Ä—Ç–∫–∞—Ö
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-container" style="position: relative; height: 300px;">
                    <canvas id="studentsClubsChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-success">
                    <i class="bi bi-pie-chart"></i> üéì –†–æ–∑–ø–æ–¥—ñ–ª –ø–æ –∫–ª–∞—Å–∞—Ö
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-container" style="position: relative; height: 300px;">
                    <canvas id="studentsGradeChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-info">
                    <i class="bi bi-pie-chart-fill"></i> üéØ –ó–∞–≥–∞–ª—å–Ω–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-container" style="position: relative; height: 300px;">
                    <canvas id="overallAttendanceChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –†—è–¥ 2: –°—Ç–æ–≤–ø—á–∞—Å—Ç—ñ –¥—ñ–∞–≥—Ä–∞–º–∏ -->
<div class="row">
    <div class="col-lg-6 col-md-12 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-warning">
                    <i class="bi bi-bar-chart-fill"></i> üìä –ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤—á–∏—Ç–µ–ª—ñ–≤
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-container" style="position: relative; height: 350px;">
                    <canvas id="teacherActivityChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6 col-md-12 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-secondary">
                    <i class="bi bi-calendar-week"></i> üìÖ –£—Ä–æ–∫–∏ –ø–æ –¥–Ω—è—Ö —Ç–∏–∂–Ω—è
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-container" style="position: relative; height: 350px;">
                    <canvas id="weekdayLessonsChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –†—è–¥ 3: –õ—ñ–Ω—ñ–π–Ω—ñ –¥—ñ–∞–≥—Ä–∞–º–∏ -->
<div class="row">
    <div class="col-lg-6 col-md-12 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="bi bi-graph-up"></i> üìà –î–∏–Ω–∞–º—ñ–∫–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–æ—Å—Ç—ñ
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-container" style="position: relative; height: 350px;">
                    <canvas id="attendanceTrendChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6 col-md-12 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-success">
                    <i class="bi bi-cash-stack"></i> üí∏ –î–∏–Ω–∞–º—ñ–∫–∞ –∑–∞—Ä–ø–ª–∞—Ç
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-container" style="position: relative; height: 350px;">
                    <canvas id="salaryTrendChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –†—è–¥ 4: –î–µ—â–æ –æ—Å–æ–±–ª–∏–≤—ñ—à—ñ –¥—ñ–∞–≥—Ä–∞–º–∏ -->
<div class="row">
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-danger">
                    <i class="bi bi-currency-dollar"></i> üí∞ –†–æ–∑–ø–æ–¥—ñ–ª –∑–∞—Ä–ø–ª–∞—Ç
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-container" style="position: relative; height: 300px;">
                    <canvas id="salaryDistributionChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-dark">
                    <i class="bi bi-geo-alt-fill"></i> üìç –ü–æ –Ω–∞—Å–µ–ª–µ–Ω–∏—Ö –ø—É–Ω–∫—Ç–∞—Ö
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-container" style="position: relative; height: 300px;">
                    <canvas id="locationChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-warning">
                    <i class="bi bi-trophy-fill"></i> üèÜ –¢–æ–ø —É—á–Ω—ñ
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-container" style="position: relative; height: 300px;">
                    <canvas id="topStudentsChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –†—è–¥ 5: –ì—Ä–∞—Ñ—ñ–∫–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ -->
<div class="row">
    <div class="col-lg-6 col-md-12 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-danger">
                    <i class="bi bi-shield-exclamation"></i> üîí –†–æ–∑–ø–æ–¥—ñ–ª –ø–æ –∫—Ä–∏—Ç–µ—Ä—ñ—è–º –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-container" style="position: relative; height: 350px;">
                    <canvas id="vulnerabilityChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6 col-md-12 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-info">
                    <i class="bi bi-bar-chart-fill"></i> üè† –î–µ—Ç–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—ñ–ª—å–≥
                </h6>
            </div>
            <div class="card-body">
                <div class="chart-container" style="position: relative; height: 350px;">
                    <canvas id="benefitsDetailChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js CDN —Ç–∞ JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// üìä –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥—ñ–∞–≥—Ä–∞–º
let chartsInstances = {};

// üé® –ö—Ä–∞—Å–∏–≤—ñ –∫–æ–ª—å–æ—Ä–∏ –¥–ª—è –¥—ñ–∞–≥—Ä–∞–º
const colorPalettes = {
    primary: ['#007bff', '#6610f2', '#6f42c1', '#e83e8c', '#dc3545', '#fd7e14', '#ffc107', '#28a745', '#20c997', '#17a2b8'],
    warm: ['#ff6b6b', '#feca57', '#48dbfb', '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43', '#10ac84', '#ee5a24'],
    cool: ['#0abde3', '#006ba6', '#0c2461', '#9980FA', '#badc58', '#f0932b', '#eb4d4b', '#6ab04c', '#22a6b3', '#be2edd'],
    pastel: ['#ff7675', '#74b9ff', '#a29bfe', '#fd79a8', '#fdcb6e', '#e17055', '#00b894', '#e84393', '#2d3436', '#636e72']
};

// üöÄ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤—Å—ñ—Ö –¥—ñ–∞–≥—Ä–∞–º
async function initializeAllCharts() {
    try {
        console.log('üìä –ó–∞–≤–∞–Ω—Ç–∞–∂—É—é –¥–∞–Ω—ñ –¥–ª—è –¥—ñ–∞–≥—Ä–∞–º...');
        
        const response = await fetch('/api/dashboard/charts');
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const chartsData = await response.json();
        console.log('‚úÖ –î–∞–Ω—ñ –æ—Ç—Ä–∏–º–∞–Ω–æ:', chartsData);
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –∫–æ–∂–Ω—É –¥—ñ–∞–≥—Ä–∞–º—É
        initStudentsClubsChart(chartsData.students_by_clubs);
        initStudentsGradeChart(chartsData.students_by_grade);
        initOverallAttendanceChart(chartsData.overall_attendance);
        initTeacherActivityChart(chartsData.teacher_activity);
        initWeekdayLessonsChart(chartsData.lessons_by_weekday);
        initAttendanceTrendChart(chartsData.attendance_trend);
        initSalaryTrendChart(chartsData.salary_trend);
        initSalaryDistributionChart(chartsData.salary_distribution);
        initLocationChart(chartsData.students_by_location);
        initTopStudentsChart(chartsData.top_students);
        
        // üîí –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ
        if (chartsData.students_by_vulnerability && chartsData.benefits_detailed) {
            await initVulnerabilityCharts();
        } else {
            console.warn('‚ö†Ô∏è –î–∞–Ω—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ –≤ API');
        }
        
        console.log('üéâ –í—Å—ñ –¥—ñ–∞–≥—Ä–∞–º–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ!');
        
    } catch (error) {
        console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥—ñ–∞–≥—Ä–∞–º:', error);
        showChartsError(error.message);
    }
}

// 1. üéØ –†–æ–∑–ø–æ–¥—ñ–ª —É—á–Ω—ñ–≤ –ø–æ –≥—É—Ä—Ç–∫–∞—Ö (–∫—Ä—É–≥–æ–≤–∞)
function initStudentsClubsChart(data) {
    const ctx = document.getElementById('studentsClubsChart').getContext('2d');
    
    if (chartsInstances.studentsClubs) {
        chartsInstances.studentsClubs.destroy();
    }
    
    chartsInstances.studentsClubs = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: data.labels,
            datasets: [{
                data: data.data,
                backgroundColor: colorPalettes.primary,
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        usePointStyle: true
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((context.parsed / total) * 100).toFixed(1);
                            return `${context.label}: ${context.parsed} (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });
}

// 2. üéì –†–æ–∑–ø–æ–¥—ñ–ª –ø–æ –∫–ª–∞—Å–∞—Ö (–∫—Ä—É–≥–æ–≤–∞)
function initStudentsGradeChart(data) {
    const ctx = document.getElementById('studentsGradeChart').getContext('2d');
    
    if (chartsInstances.studentsGrade) {
        chartsInstances.studentsGrade.destroy();
    }
    
    chartsInstances.studentsGrade = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: data.labels,
            datasets: [{
                data: data.data,
                backgroundColor: colorPalettes.warm,
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        usePointStyle: true
                    }
                }
            }
        }
    });
}

// 3. üéØ –ó–∞–≥–∞–ª—å–Ω–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å (–∫—Ä—É–≥–æ–≤–∞)
function initOverallAttendanceChart(data) {
    const ctx = document.getElementById('overallAttendanceChart').getContext('2d');
    
    if (chartsInstances.overallAttendance) {
        chartsInstances.overallAttendance.destroy();
    }
    
    chartsInstances.overallAttendance = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: data.labels,
            datasets: [{
                data: data.data,
                backgroundColor: ['#28a745', '#dc3545'],
                borderWidth: 3,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        usePointStyle: true
                    }
                }
            }
        }
    });
}

// 4. üìä –ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤—á–∏—Ç–µ–ª—ñ–≤ (—Å—Ç–æ–≤–ø—á–∞—Å—Ç–∞)
function initTeacherActivityChart(data) {
    const ctx = document.getElementById('teacherActivityChart').getContext('2d');
    
    if (chartsInstances.teacherActivity) {
        chartsInstances.teacherActivity.destroy();
    }
    
    chartsInstances.teacherActivity = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels,
            datasets: [
                {
                    label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å —É—Ä–æ–∫—ñ–≤',
                    data: data.lessons,
                    backgroundColor: '#007bff',
                    borderColor: '#0056b3',
                    borderWidth: 1
                },
                {
                    label: '–í—Å—å–æ–≥–æ —É—á–Ω—ñ–≤ –Ω–∞–≤—á–µ–Ω–æ',
                    data: data.students,
                    backgroundColor: '#28a745',
                    borderColor: '#1e7e34',
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    position: 'top'
                }
            }
        }
    });
}

// 5. üìÖ –£—Ä–æ–∫–∏ –ø–æ –¥–Ω—è—Ö —Ç–∏–∂–Ω—è (—Å—Ç–æ–≤–ø—á–∞—Å—Ç–∞)
function initWeekdayLessonsChart(data) {
    const ctx = document.getElementById('weekdayLessonsChart').getContext('2d');
    
    if (chartsInstances.weekdayLessons) {
        chartsInstances.weekdayLessons.destroy();
    }
    
    chartsInstances.weekdayLessons = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels,
            datasets: [{
                label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å —É—Ä–æ–∫—ñ–≤',
                data: data.data,
                backgroundColor: colorPalettes.cool,
                borderColor: '#fff',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}

// 6. üìà –î–∏–Ω–∞–º—ñ–∫–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–æ—Å—Ç—ñ (–ª—ñ–Ω—ñ–π–Ω–∞)
function initAttendanceTrendChart(data) {
    const ctx = document.getElementById('attendanceTrendChart').getContext('2d');
    
    if (chartsInstances.attendanceTrend) {
        chartsInstances.attendanceTrend.destroy();
    }
    
    chartsInstances.attendanceTrend = new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [{
                label: '–í—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å (%)',
                data: data.data,
                borderColor: '#007bff',
                backgroundColor: 'rgba(0, 123, 255, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    position: 'top'
                }
            }
        }
    });
}

// 7. üí∏ –î–∏–Ω–∞–º—ñ–∫–∞ –∑–∞—Ä–ø–ª–∞—Ç (–ª—ñ–Ω—ñ–π–Ω–∞)
function initSalaryTrendChart(data) {
    const ctx = document.getElementById('salaryTrendChart').getContext('2d');
    
    if (chartsInstances.salaryTrend) {
        chartsInstances.salaryTrend.destroy();
    }
    
    chartsInstances.salaryTrend = new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [{
                label: '–ó–∞—Ä–ø–ª–∞—Ç–∞ (–≥—Ä–Ω)',
                data: data.data,
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString('uk-UA') + ' –≥—Ä–Ω';
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    position: 'top'
                }
            }
        }
    });
}

// 8. üí∞ –†–æ–∑–ø–æ–¥—ñ–ª –∑–∞—Ä–ø–ª–∞—Ç (–∫—ñ–ª—å—Ü–µ–≤–∞)
function initSalaryDistributionChart(data) {
    const ctx = document.getElementById('salaryDistributionChart').getContext('2d');
    
    if (chartsInstances.salaryDistribution) {
        chartsInstances.salaryDistribution.destroy();
    }
    
    chartsInstances.salaryDistribution = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: data.labels,
            datasets: [{
                data: data.data,
                backgroundColor: colorPalettes.pastel,
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        usePointStyle: true
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: ${context.parsed.toLocaleString('uk-UA')} –≥—Ä–Ω`;
                        }
                    }
                }
            }
        }
    });
}

// 9. üìç –ü–æ –Ω–∞—Å–µ–ª–µ–Ω–∏—Ö –ø—É–Ω–∫—Ç–∞—Ö (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞ —Å—Ç–æ–≤–ø—á–∞—Å—Ç–∞)
function initLocationChart(data) {
    const ctx = document.getElementById('locationChart').getContext('2d');
    
    if (chartsInstances.location) {
        chartsInstances.location.destroy();
    }
    
    chartsInstances.location = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels,
            datasets: [{
                label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å —É—á–Ω—ñ–≤',
                data: data.data,
                backgroundColor: colorPalettes.cool,
                borderColor: '#fff',
                borderWidth: 1
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}

// 10. üèÜ –¢–æ–ø —É—á–Ω—ñ (—Å—Ç–æ–≤–ø—á–∞—Å—Ç–∞)
function initTopStudentsChart(data) {
    const ctx = document.getElementById('topStudentsChart').getContext('2d');
    
    if (chartsInstances.topStudents) {
        chartsInstances.topStudents.destroy();
    }
    
    chartsInstances.topStudents = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels,
            datasets: [{
                label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å',
                data: data.data,
                backgroundColor: colorPalettes.warm,
                borderColor: '#fff',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    ticks: {
                        maxRotation: 45,
                        minRotation: 45
                    }
                },
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}

// üîí –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ
async function initVulnerabilityCharts() {
    try {
        console.log('üìä –ó–∞–≤–∞–Ω—Ç–∞–∂—É—é –¥–∞–Ω—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ...');
        
        // –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ —Ç–∞ –æ–±—á–∏—Å–ª—é—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ
        const studentsResponse = await fetch('/api/students');
        if (!studentsResponse.ok) {
            throw new Error(`HTTP ${studentsResponse.status}: ${studentsResponse.statusText}`);
        }
        
        const students = await studentsResponse.json();
        console.log('‚úÖ –î–∞–Ω—ñ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –æ—Ç—Ä–∏–º–∞–Ω–æ:', students.length, '—Å—Ç—É–¥–µ–Ω—Ç—ñ–≤');
        
        // –û–±—á–∏—Å–ª—é—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ
        const vulnerabilityStats = calculateVulnerabilityStats(students);
        const benefitsStats = calculateBenefitsStats(students);
        
        console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ:', vulnerabilityStats);
        console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—ñ–ª—å–≥:', benefitsStats);
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –¥–∞–Ω—ñ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        const hasVulnerabilityData = Object.values(vulnerabilityStats).some(count => count > 0);
        const hasBenefitsData = Object.values(benefitsStats).some(count => count > 0);
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –≥—Ä–∞—Ñ—ñ–∫–∏ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î –¥–∞–Ω—ñ
        if (hasVulnerabilityData) {
            initVulnerabilityPieChart(vulnerabilityStats);
        } else {
            showEmptyChart('vulnerabilityChart', 'üìä –ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø—Ä–æ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å', '–£ —Å–∏—Å—Ç–µ–º—ñ –ø–æ–∫–∏ –Ω–µ–º–∞—î —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∑ –ø—ñ–ª—å–≥–∞–º–∏. –î–æ–¥–∞–π—Ç–µ –ø—ñ–ª—å–≥–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.');
        }
        
        if (hasBenefitsData) {
            initBenefitsBarChart(benefitsStats);
        } else {
            showEmptyChart('benefitsChart', 'üìä –ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø—Ä–æ –ø—ñ–ª—å–≥–∏', '–£ —Å–∏—Å—Ç–µ–º—ñ –ø–æ–∫–∏ –Ω–µ–º–∞—î —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∑ –ø—ñ–ª—å–≥–∞–º–∏. –î–æ–¥–∞–π—Ç–µ –ø—ñ–ª—å–≥–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.');
        }
        
        console.log('üîí –ì—Ä–∞—Ñ—ñ–∫–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ!');
        
    } catch (error) {
        console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ:', error);
        
        // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–º–∏–ª–∫—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö –¥—ñ–∞–≥—Ä–∞–º
        showEmptyChart('vulnerabilityChart', '‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è', error.message);
        showEmptyChart('benefitsChart', '‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è', error.message);
    }
}

// üö® –ü–æ–∫–∞–∑ –ø—É—Å—Ç–æ—ó –¥—ñ–∞–≥—Ä–∞–º–∏ –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º
function showEmptyChart(chartId, title, message) {
    const chartElement = document.getElementById(chartId);
    if (chartElement) {
        const container = chartElement.parentElement;
        if (container) {
            container.innerHTML = `
                <div class="alert alert-info text-center" role="alert">
                    <h5 class="alert-heading">${title}</h5>
                    <p class="mb-0">${message}</p>
                </div>
            `;
        }
    }
}

// üìä –û–±—á–∏—Å–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ
function calculateVulnerabilityStats(students) {
    const stats = {
        '–í–ü–û (–ø–µ—Ä–µ—Å–µ–ª–µ–Ω—Ü—ñ)': 0,
        '–î—ñ—Ç–∏ –∑ —ñ–Ω–≤–∞–ª—ñ–¥–Ω—ñ—Å—Ç—é': 0,
        '–ë–∞–≥–∞—Ç–æ–¥—ñ—Ç–Ω—ñ —Å—ñ–º\'—ó': 0,
        '–°—ñ–º\'—ó –ó–°–£': 0,
        '–ú–∞–ª–æ–∑–∞–±–µ–∑–ø–µ—á–µ–Ω—ñ': 0,
        '–°–∏—Ä–æ—Ç–∏/–ø—ñ–¥ –æ–ø—ñ–∫–æ—é': 0,
        '–°–æ—Ü—ñ–∞–ª—å–Ω–∏–π —Ä–∏–∑–∏–∫': 0,
        '–ë–µ–∑ –ø—ñ–ª—å–≥': 0
    };
    
    students.forEach(student => {
        let hasBenefit = false;
        
        if (student.benefit_internally_displaced) {
            stats['–í–ü–û (–ø–µ—Ä–µ—Å–µ–ª–µ–Ω—Ü—ñ)']++;
            hasBenefit = true;
        }
        if (student.benefit_disability) {
            stats['–î—ñ—Ç–∏ –∑ —ñ–Ω–≤–∞–ª—ñ–¥–Ω—ñ—Å—Ç—é']++;
            hasBenefit = true;
        }
        if (student.benefit_large_family) {
            stats['–ë–∞–≥–∞—Ç–æ–¥—ñ—Ç–Ω—ñ —Å—ñ–º\'—ó']++;
            hasBenefit = true;
        }
        if (student.benefit_military_family) {
            stats['–°—ñ–º\'—ó –ó–°–£']++;
            hasBenefit = true;
        }
        if (student.benefit_low_income) {
            stats['–ú–∞–ª–æ–∑–∞–±–µ–∑–ø–µ—á–µ–Ω—ñ']++;
            hasBenefit = true;
        }
        if (student.benefit_orphan) {
            stats['–°–∏—Ä–æ—Ç–∏/–ø—ñ–¥ –æ–ø—ñ–∫–æ—é']++;
            hasBenefit = true;
        }
        if (student.benefit_social_risk) {
            stats['–°–æ—Ü—ñ–∞–ª—å–Ω–∏–π —Ä–∏–∑–∏–∫']++;
            hasBenefit = true;
        }
        
        if (!hasBenefit) {
            stats['–ë–µ–∑ –ø—ñ–ª—å–≥']++;
        }
    });
    
    return stats;
}

// üìä –û–±—á–∏—Å–ª–µ–Ω–Ω—è –¥–µ—Ç–∞–ª—å–Ω–æ—ó —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—ñ–ª—å–≥
function calculateBenefitsStats(students) {
    return {
        '–í–ü–û': students.filter(s => s.benefit_internally_displaced).length,
        '–Ü–Ω–≤–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å': students.filter(s => s.benefit_disability).length,
        '–ë–∞–≥–∞—Ç–æ–¥—ñ—Ç–Ω—ñ': students.filter(s => s.benefit_large_family).length,
        '–°—ñ–º\'—ó –ó–°–£': students.filter(s => s.benefit_military_family).length,
        '–ú–∞–ª–æ–∑–∞–±–µ–∑–ø–µ—á–µ–Ω—ñ': students.filter(s => s.benefit_low_income).length,
        '–°–∏—Ä–æ—Ç–∏': students.filter(s => s.benefit_orphan).length,
        '–°–æ—Ü. —Ä–∏–∑–∏–∫': students.filter(s => s.benefit_social_risk).length
    };
}

// üîí –ö—Ä—É–≥–æ–≤–∞ –¥—ñ–∞–≥—Ä–∞–º–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ
function initVulnerabilityPieChart(stats) {
    const ctx = document.getElementById('vulnerabilityChart').getContext('2d');
    
    if (chartsInstances.vulnerability) {
        chartsInstances.vulnerability.destroy();
    }
    
    // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑ —É—á–Ω—è–º–∏
    const labels = [];
    const data = [];
    const colors = [];
    
    const colorMap = {
        '–í–ü–û (–ø–µ—Ä–µ—Å–µ–ª–µ–Ω—Ü—ñ)': '#DC3545',  // —á–µ—Ä–≤–æ–Ω–∏–π
        '–î—ñ—Ç–∏ –∑ —ñ–Ω–≤–∞–ª—ñ–¥–Ω—ñ—Å—Ç—é': '#6F42C1', // —Ñ—ñ–æ–ª–µ—Ç–æ–≤–∏–π
        '–ë–∞–≥–∞—Ç–æ–¥—ñ—Ç–Ω—ñ —Å—ñ–º\'—ó': '#28A745',   // –∑–µ–ª–µ–Ω–∏–π
        '–°—ñ–º\'—ó –ó–°–£': '#FFC107',          // –∂–æ–≤—Ç–∏–π
        '–ú–∞–ª–æ–∑–∞–±–µ–∑–ø–µ—á–µ–Ω—ñ': '#FD7E14',     // –ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π
        '–°–∏—Ä–æ—Ç–∏/–ø—ñ–¥ –æ–ø—ñ–∫–æ—é': '#17A2B8',   // –±–ª–∞–∫–∏—Ç–Ω–∏–π
        '–°–æ—Ü—ñ–∞–ª—å–Ω–∏–π —Ä–∏–∑–∏–∫': '#E83E8C',    // —Ä–æ–∂–µ–≤–∏–π
        '–ë–µ–∑ –ø—ñ–ª—å–≥': '#6C757D'            // —Å—ñ—Ä–∏–π
    };
    
    Object.entries(stats).forEach(([label, count]) => {
        if (count > 0) {
            labels.push(label);
            data.push(count);
            colors.push(colorMap[label]);
        }
    });
    
    chartsInstances.vulnerability = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: colors,
                borderWidth: 2,
                borderColor: '#fff',
                hoverBorderWidth: 3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 12,
                        usePointStyle: true,
                        font: {
                            size: 11
                        }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((context.parsed / total) * 100).toFixed(1);
                            return `${context.label}: ${context.parsed} (${percentage}%)`;
                        }
                    }
                }
            },
            animation: {
                animateRotate: true,
                duration: 1000
            }
        }
    });
}

// üè† –°—Ç–æ–≤–ø—á–∞—Å—Ç–∞ –¥—ñ–∞–≥—Ä–∞–º–∞ –¥–µ—Ç–∞–ª—å–Ω–∏—Ö –ø—ñ–ª—å–≥
function initBenefitsBarChart(stats) {
    const ctx = document.getElementById('benefitsDetailChart').getContext('2d');
    
    if (chartsInstances.benefitsDetail) {
        chartsInstances.benefitsDetail.destroy();
    }
    
    const labels = Object.keys(stats);
    const data = Object.values(stats);
    
    chartsInstances.benefitsDetail = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å —É—á–Ω—ñ–≤',
                data: data,
                backgroundColor: [
                    '#DC3545', // –í–ü–û
                    '#6F42C1', // –Ü–Ω–≤–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å
                    '#28A745', // –ë–∞–≥–∞—Ç–æ–¥—ñ—Ç–Ω—ñ
                    '#FFC107', // –ó–°–£
                    '#FD7E14', // –ú–∞–ª–æ–∑–∞–±–µ–∑–ø–µ—á–µ–Ω—ñ
                    '#17A2B8', // –°–∏—Ä–æ—Ç–∏
                    '#E83E8C'  // –°–æ—Ü. —Ä–∏–∑–∏–∫
                ],
                borderWidth: 1,
                borderRadius: 4,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        title: function(context) {
                            return `–ö–∞—Ç–µ–≥–æ—Ä—ñ—è: ${context[0].label}`;
                        },
                        label: function(context) {
                            return `–£—á–Ω—ñ–≤: ${context.parsed.y}`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    },
                    title: {
                        display: true,
                        text: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å —É—á–Ω—ñ–≤'
                    }
                },
                x: {
                    ticks: {
                        maxRotation: 45,
                        minRotation: 0
                    }
                }
            },
            animation: {
                duration: 800,
                easing: 'easeInOutQuart'
            }
        }
    });
}

// üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö –¥—ñ–∞–≥—Ä–∞–º
async function refreshAllCharts() {
    const button = document.querySelector('button[onclick="refreshAllCharts()"]');
    const originalText = button.innerHTML;
    
    button.innerHTML = '<i class="bi bi-arrow-clockwise"></i> –û–Ω–æ–≤–ª–µ–Ω–Ω—è...';
    button.disabled = true;
    
    try {
        await initializeAllCharts();
        
        // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö
        button.innerHTML = '<i class="bi bi-check"></i> –û–Ω–æ–≤–ª–µ–Ω–æ!';
        setTimeout(() => {
            button.innerHTML = originalText;
            button.disabled = false;
        }, 2000);
        
    } catch (error) {
        button.innerHTML = '<i class="bi bi-exclamation-triangle"></i> –ü–æ–º–∏–ª–∫–∞!';
        setTimeout(() => {
            button.innerHTML = originalText;
            button.disabled = false;
        }, 3000);
    }
}

// üö® –ü–æ–∫–∞–∑ –ø–æ–º–∏–ª–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
function showChartsError(message) {
    const errorHTML = `
        <div class="alert alert-danger" role="alert">
            <h4 class="alert-heading">‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥—ñ–∞–≥—Ä–∞–º</h4>
            <p>–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –¥–ª—è –¥—ñ–∞–≥—Ä–∞–º:</p>
            <hr>
            <p class="mb-0"><code>${message}</code></p>
        </div>
    `;
    
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —ñ –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–º–∏–ª–∫—É
    const chartsContainer = document.querySelector('.row.mt-5');
    if (chartsContainer) {
        chartsContainer.innerHTML = errorHTML;
    }
}

// üöÄ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
document.addEventListener('DOMContentLoaded', function() {
    console.log('üìä –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è dashboard –¥—ñ–∞–≥—Ä–∞–º...');
    
    // –ó–∞—Ç—Ä–∏–º–∫–∞ –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Bootstrap —Ç–∞ Chart.js
    setTimeout(() => {
        initializeAllCharts();
    }, 500);
});
</script>

{% endblock %}
