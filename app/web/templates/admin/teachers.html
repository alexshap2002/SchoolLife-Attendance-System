{% extends "base.html" %}

{% block content %}
<style>
/* –°—Ç–∏–ª—ñ –≤—á–∏—Ç–µ–ª—ñ–≤ –≤ —Å—Ç–∏–ª—ñ —ñ–Ω—à–∏—Ö —Ç–∞–±–ª–∏—Ü—å */
#teachersTable {
    margin-top: 20px;
}

/* STICKY COLUMN - –§—ñ–∫—Å–æ–≤–∞–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ "–ü–æ–≤–Ω–µ —ñ–º'—è" */
.table-responsive {
    position: relative;
}

/* –§—ñ–∫—Å–∞—Ü—ñ—è –ø–µ—Ä—à–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è (–ü–æ–≤–Ω–µ —ñ–º'—è) */
#teachersTable th:nth-child(1), 
#teachersTable td:nth-child(1) { 
    position: sticky;
    left: 0;
    z-index: 10;
    background-color: #ffffff;
    width: 200px;
    min-width: 200px;
    max-width: 200px;
    box-shadow: 2px 0 5px rgba(0,0,0,0.1); /* —Ç—ñ–Ω—å —Å–ø—Ä–∞–≤–∞ */
    border-right: 2px solid #007bff; /* —Å–∏–Ω—è –º–µ–∂–∞ –¥–ª—è –∫—Ä–∞—â–æ—ó –≤–∏–¥–∏–º–æ—Å—Ç—ñ */
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ sticky —Å—Ç–æ–≤–ø—Ü—è –º–∞—î –≤–∏—â–∏–π z-index */
#teachersTable thead th:nth-child(1) {
    z-index: 11;
    background-color: #f8f9fa; /* —Ç—Ä–æ—Ö–∏ —Å—ñ—Ä–∏–π —Ñ–æ–Ω –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ */
}

/* –§—ñ–ª—å—Ç—Ä –≤ sticky —Å—Ç–æ–≤–ø—Ü—ñ */
#teachersTable .filter-row td:nth-child(1) {
    background-color: #f8f9fa;
    z-index: 10;
}

/* –°–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ —Ä–æ–∑–º—ñ—Ä–∏ –¥–ª—è —ñ–Ω—à–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ */
#teachersTable th:nth-child(2), #teachersTable td:nth-child(2) { min-width: 140px; } /* Telegram */
#teachersTable th:nth-child(3), #teachersTable td:nth-child(3) { min-width: 100px; } /* –°—Ç–∞—Ç—É—Å */
#teachersTable th:nth-child(4), #teachersTable td:nth-child(4) { min-width: 140px; } /* –î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è */

/* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑ —è—Å–∫—Ä–∞–≤–∏—Ö –∫–æ–ª—å–æ—Ä—ñ–≤ */
#teachersTable thead th {
    white-space: nowrap;
    padding: 12px 8px;
}

/* –§—ñ–ª—å—Ç—Ä–∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ñ */
#teachersTable .filter-row td {
    padding: 8px 6px;
}

#teachersTable .filter-input,
#teachersTable .filter-select {
    font-size: 0.85rem;
    padding: 4px 8px;
    min-width: 90px;
}

/* –°—Ç–∞—Ç—É—Å–∏ –≥—É—Ä—Ç–∫—ñ–≤ - —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –≤–∂–µ —î –≤ –±–∞–∑–æ–≤–∏—Ö —Å—Ç–∏–ª—è—Ö */
#teachersTable .club-status {
    font-size: 1.1rem;
}

/* –ö–Ω–æ–ø–∫–∏ –¥—ñ–π */
#teachersTable .btn-group .btn {
    margin: 0 1px;
    padding: 4px 8px;
}

/* –í—ñ–∑—É–∞–ª—å–Ω–∏–π —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä —â–æ —Å—Ç–æ–≤–ø–µ—Ü—å –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π */
#teachersTable th:nth-child(1):after {
    content: " üìå";
    font-size: 0.8em;
    opacity: 0.6;
}

/* STICKY SCROLLBAR - –ü–ª–∞–≤–∞—é—á–∏–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∏–π —Å–∫—Ä–æ–ª–±–∞—Ä */
.sticky-scrollbar-container {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    background: rgba(0, 0, 0, 0.9);
    border-radius: 25px;
    padding: 10px 20px;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    max-width: 80vw;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.sticky-scrollbar-container.visible {
    opacity: 1;
    visibility: visible;
}

.sticky-scrollbar {
    width: 300px;
    height: 8px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 4px;
    position: relative;
    cursor: pointer;
}

.sticky-scrollbar-thumb {
    height: 100%;
    background: #007bff;
    border-radius: 4px;
    position: absolute;
    top: 0;
    left: 0;
    min-width: 20px;
    transition: background-color 0.2s ease;
}

.sticky-scrollbar-thumb:hover {
    background: #0056b3;
}

.sticky-scrollbar-label {
    color: white;
    font-size: 0.75rem;
    margin-bottom: 5px;
    text-align: center;
    font-weight: 500;
}

/* –î–æ–¥–∞—Ç–∫–æ–≤–µ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–±–∞—Ä–∞ */
.table-responsive::-webkit-scrollbar {
    height: 12px;
}

.table-responsive::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 6px;
}

.table-responsive::-webkit-scrollbar-thumb {
    background: #007bff;
    border-radius: 6px;
}

.table-responsive::-webkit-scrollbar-thumb:hover {
    background: #0056b3;
}

/* Responsive –¥–∏–∑–∞–π–Ω –¥–ª—è sticky scrollbar */
@media (max-width: 768px) {
    .sticky-scrollbar-container {
        bottom: 10px;
        padding: 8px 15px;
        max-width: 90vw;
    }
    
    .sticky-scrollbar {
        width: 250px;
    }
    
    .sticky-scrollbar-label {
        font-size: 0.7rem;
    }
}

@media (max-width: 480px) {
    .sticky-scrollbar {
        width: 200px;
    }
    
    .sticky-scrollbar-container {
        padding: 6px 12px;
    }
}

/* –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—è —â–æ scrollbar –∞–∫—Ç–∏–≤–Ω–∏–π */
.sticky-scrollbar-container.visible {
    animation: slideUp 0.3s ease;
}

@keyframes slideUp {
    from {
        transform: translateX(-50%) translateY(20px);
        opacity: 0;
    }
    to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }
}
</style>

<!-- –î–æ–¥–∞—î–º–æ –≤—ñ–¥—Å—Ç—É–ø –∑–≤–µ—Ä—Ö—É –∑–∞–º—ñ—Å—Ç—å –ø–æ–¥–≤—ñ–π–Ω–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ -->
<div class="mt-4 pt-3"></div>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2>üë®‚Äçüè´ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≤—á–∏—Ç–µ–ª—è–º–∏</h2>
        <small class="text-muted">
            üìå –°—Ç–æ–≤–ø–µ—Ü—å "–ü–æ–≤–Ω–µ —ñ–º'—è" –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—á—É–≤–∞–Ω–Ω—ñ
        </small>
    </div>
    <div class="btn-group">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTeacherModal">
            <i class="bi bi-plus-circle"></i> –î–æ–¥–∞—Ç–∏ –≤—á–∏—Ç–µ–ª—è
        </button>
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-file-earmark-excel"></i> –Ü–º–ø–æ—Ä—Ç Excel
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="downloadTeachersTemplate()">
                    <i class="bi bi-download"></i> –°–∫–∞—á–∞—Ç–∏ —à–∞–±–ª–æ–Ω
                </a></li>
                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#importTeachersModal">
                    <i class="bi bi-upload"></i> –Ü–º–ø–æ—Ä—Ç –≤—á–∏—Ç–µ–ª—ñ–≤
                </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#" onclick="exportTeachersExcel()">
                    <i class="bi bi-file-earmark-spreadsheet"></i> –ï–∫—Å–ø–æ—Ä—Ç –≤ Excel
                </a></li>
            </ul>
        </div>
    </div>
</div>

<div class="card shadow">
    <div class="card-body">
        <div class="table-responsive" id="teachersTableContainer">
            <table class="table table-hover" id="teachersTable">
                <thead id="teachersTableHead">
                    <!-- –î–∏–Ω–∞–º—ñ—á–Ω–æ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –≤ JavaScript -->
                </thead>
                <tbody id="teachersTableBody">
                    <!-- –î–∏–Ω–∞–º—ñ—á–Ω–æ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –≤ JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="mt-4">
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—á–∏—Ç–µ–ª—ñ–≤</h5>
                </div>
                <div class="card-body">
                    <p><strong>–í—Å—å–æ–≥–æ –≤—á–∏—Ç–µ–ª—ñ–≤:</strong> {{ teachers|length }}</p>
                    <p><strong>–ê–∫—Ç–∏–≤–Ω–∏—Ö:</strong> {{ teachers|selectattr('active')|list|length }}</p>
                    <p><strong>–ó Telegram:</strong> {{ teachers|selectattr('tg_username')|list|length }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">–®–≤–∏–¥–∫—ñ –¥—ñ—ó</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addTeacherModal">
                            <i class="bi bi-person-plus"></i> –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ –≤—á–∏—Ç–µ–ª—è
                        </button>
                        <button type="button" class="btn btn-outline-info" onclick="exportTeachers()">
                            <i class="bi bi-download"></i> –ï–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫—É
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Teacher Modal -->
<div class="modal fade" id="addTeacherModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ –≤—á–∏—Ç–µ–ª—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addTeacherForm">
                    <div class="mb-3">
                        <label for="fullName" class="form-label">–ü–æ–≤–Ω–µ —ñ–º'—è *</label>
                        <input type="text" class="form-control" id="fullName" name="fullName" required>
                    </div>
                    <div class="mb-3">
                        <label for="tgUsername" class="form-label">Telegram username</label>
                        <div class="input-group">
                            <span class="input-group-text">@</span>
                            <input type="text" class="form-control" id="tgUsername" name="tgUsername" placeholder="username">
                        </div>
                        <div class="form-text">–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ - –¥–ª—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó</div>
                    </div>
                    <div class="mb-3">
                        <label for="tgChatId" class="form-label">Telegram Chat ID</label>
                        <input type="number" class="form-control" id="tgChatId" name="tgChatId" placeholder="123456789">
                        <div class="form-text">–í—á–∏—Ç–µ–ª—å –æ—Ç—Ä–∏–º—É—î —Ü–µ–π –Ω–æ–º–µ—Ä –Ω–∞—Ç–∏—Å–Ω—É–≤—à–∏ /start –≤ –±–æ—Ç—ñ. –ü–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è —Ä–æ–∑—Å–∏–ª–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å.</div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="active" name="active" checked>
                            <label class="form-check-label" for="active">
                                –ê–∫—Ç–∏–≤–Ω–∏–π –≤—á–∏—Ç–µ–ª—å
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button type="button" class="btn btn-primary" onclick="saveTeacher()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Teacher Modal -->
<div class="modal fade" id="editTeacherModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≤—á–∏—Ç–µ–ª—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editTeacherForm">
                    <input type="hidden" id="editTeacherId">
                    <div class="mb-3">
                        <label for="editFullName" class="form-label">–ü–æ–≤–Ω–µ —ñ–º'—è *</label>
                        <input type="text" class="form-control" id="editFullName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editTgUsername" class="form-label">Telegram username</label>
                        <div class="input-group">
                            <span class="input-group-text">@</span>
                            <input type="text" class="form-control" id="editTgUsername" placeholder="username">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editTgChatId" class="form-label">Telegram Chat ID</label>
                        <input type="number" class="form-control" id="editTgChatId" placeholder="123456789">
                        <div class="form-text">ID —á–∞—Ç—É –≤ Telegram</div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="editActive">
                            <label class="form-check-label" for="editActive">
                                –ê–∫—Ç–∏–≤–Ω–∏–π –≤—á–∏—Ç–µ–ª—å
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button type="button" class="btn btn-primary" onclick="updateTeacher()">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
            </div>
        </div>
    </div>
</div>

<!-- Import Teachers Modal -->
<div class="modal fade" id="importTeachersModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">üìä –Ü–º–ø–æ—Ä—Ç –≤—á–∏—Ç–µ–ª—ñ–≤ –∑ Excel —Ñ–∞–π–ª—É</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <h6><i class="bi bi-info-circle"></i> –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó:</h6>
                    <ul class="mb-0">
                        <li>–°–∫–∞—á–∞–π—Ç–µ —à–∞–±–ª–æ–Ω Excel —Ñ–∞–π–ª—É –¥–ª—è –≤—á–∏—Ç–µ–ª—ñ–≤</li>
                        <li>–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –π–æ–≥–æ –¥–∞–Ω–∏–º–∏ –≤—á–∏—Ç–µ–ª—ñ–≤</li>
                        <li>–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ —ñ–º–ø–æ—Ä—Ç—É</li>
                        <li><strong>–û–±–æ–≤'—è–∑–∫–æ–≤–µ –ø–æ–ª–µ:</strong> "–ü–æ–≤–Ω–µ —ñ–º'—è"</li>
                        <li><strong>–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –ø–æ–ª—è:</strong> Telegram Username, Chat ID, –ê–∫—Ç–∏–≤–Ω–∏–π —Å—Ç–∞—Ç—É—Å</li>
                    </ul>
                </div>
                
                <form id="importTeachersForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="teachersExcelFile" class="form-label">–í–∏–±–µ—Ä—ñ—Ç—å Excel —Ñ–∞–π–ª *</label>
                        <input type="file" class="form-control" id="teachersExcelFile" name="teachersExcelFile" 
                               accept=".xlsx,.xls" required>
                        <div class="form-text">–ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏: .xlsx, .xls</div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="skipTeachersDuplicates" name="skipTeachersDuplicates" checked>
                            <label class="form-check-label" for="skipTeachersDuplicates">
                                –ü—Ä–æ–ø—É—Å–∫–∞—Ç–∏ –¥—É–±–ª—ñ–∫–∞—Ç–∏ (–ø–æ –ø–æ–≤–Ω–æ–º—É —ñ–º–µ–Ω—ñ)
                            </label>
                        </div>
                    </div>
                </form>
                
                <!-- –ü—Ä–æ–≥—Ä–µ—Å —ñ–º–ø–æ—Ä—Ç—É -->
                <div id="importTeachersProgress" style="display: none;">
                    <div class="progress mb-3">
                        <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div id="importTeachersStatus" class="text-muted"></div>
                </div>
                
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —ñ–º–ø–æ—Ä—Ç—É -->
                <div id="importTeachersResults" style="display: none;">
                    <div class="alert alert-success">
                        <h6><i class="bi bi-check-circle"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —ñ–º–ø–æ—Ä—Ç—É:</h6>
                        <div id="importTeachersSummary"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä–∏—Ç–∏</button>
                <button type="button" class="btn btn-outline-primary" onclick="downloadTeachersTemplate()">
                    <i class="bi bi-download"></i> –°–∫–∞—á–∞—Ç–∏ —à–∞–±–ª–æ–Ω
                </button>
                <button type="button" class="btn btn-primary" onclick="importTeachers()">
                    <i class="bi bi-upload"></i> –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –ü–ª–∞–≤–∞—é—á–∏–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∏–π —Å–∫—Ä–æ–ª–±–∞—Ä -->
<div class="sticky-scrollbar-container" id="stickyScrollbar">
    <div class="sticky-scrollbar-label">üìä –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ñ</div>
    <div class="sticky-scrollbar" id="stickyScrollbarTrack">
        <div class="sticky-scrollbar-thumb" id="stickyScrollbarThumb"></div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<!-- JavaScript —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–µ–ø–µ—Ä –≤ admin.js -->
{% endblock %}
