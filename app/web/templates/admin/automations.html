{% extends "base.html" %}

{% block content %}
<!-- –î–æ–¥–∞—î–º–æ –≤—ñ–¥—Å—Ç—É–ø –∑–≤–µ—Ä—Ö—É -->
<div class="mt-4 pt-3"></div>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>ü§ñ –î–æ–¥–∞—Ç–∫–æ–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è</h2>
    <button type="button" class="btn btn-primary" onclick="openAddAutomationModal()">
        <i class="bi bi-plus-circle"></i> –î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—é
    </button>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title text-primary">–ê–∫—Ç–∏–≤–Ω–∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π</h5>
                <h3 id="activeAutomationsCount" class="text-success">-</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title text-primary">–í–∏–º–∫–Ω–µ–Ω–∏—Ö</h5>
                <h3 id="disabledAutomationsCount" class="text-warning">-</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title text-primary">–í—Å—å–æ–≥–æ —Ç–∏–ø—ñ–≤</h5>
                <h3 id="totalTypesCount" class="text-info">15</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title text-primary">Telegram –∞–¥–º—ñ–Ω—ñ–≤</h5>
                <h3 id="telegramAdminsCount" class="text-info">-</h3>
            </div>
        </div>
    </div>
</div>

<!-- –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è Telegram –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏ -->
<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">üì± Telegram –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏</h5>
        <button class="btn btn-outline-primary btn-sm" onclick="loadTelegramAdmins()">
            <i class="bi bi-arrow-clockwise"></i> –û–Ω–æ–≤–∏—Ç–∏
        </button>
    </div>
    <div class="card-body">
        <div id="telegramAdminsLoading" class="text-center py-3">
            <div class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
            </div>
            <span class="ms-2">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤...</span>
        </div>
        
        <div id="telegramAdminsContent" style="display: none;">
            <div class="row" id="telegramAdminsRow">
                <!-- –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
            </div>
        </div>
        
        <div id="noTelegramAdmins" style="display: none;" class="text-center py-3">
            <i class="bi bi-person-x text-muted"></i>
            <span class="text-muted ms-2">–ù–µ–º–∞—î –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏—Ö Telegram –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤</span>
        </div>
    </div>
</div>

<!-- –§—ñ–ª—å—Ç—Ä–∏ -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <label for="typeFilter" class="form-label">–¢–∏–ø –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó:</label>
                <select class="form-select" id="typeFilter">
                    <option value="">–í—Å—ñ —Ç–∏–ø–∏</option>
                    <option value="BIRTHDAYS">üéÇ –î–Ω—ñ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</option>
                    <option value="LESSON_REMINDER_30">‚è∞ –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∑–∞ 30 —Ö–≤</option>
                    <option value="LESSON_REMINDER_10">üîî –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∑–∞ 10 —Ö–≤</option>
                    <option value="DAILY_REPORT">üìä –©–æ–¥–µ–Ω–Ω–∏–π –∑–≤—ñ—Ç</option>
                    <option value="WEEKLY_ATTENDANCE">üìà –¢–∏–∂–Ω–µ–≤–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å</option>
                    <option value="LOW_ATTENDANCE_ALERT">‚ö†Ô∏è –ù–∏–∑—å–∫–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å</option>
                    <option value="MISSING_ATTENDANCE">‚ùå –ù–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å</option>
                    <option value="TEACHER_WORKLOAD">üë®‚Äçüè´ –ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—á–∏—Ç–µ–ª—ñ–≤</option>
                    <option value="STUDENT_PROGRESS">üìö –ü—Ä–æ–≥—Ä–µ—Å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</option>
                    <option value="PAYROLL_REMINDER">üí∞ –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –∑–∞—Ä–ø–ª–∞—Ç–∏</option>
                    <option value="EQUIPMENT_CHECK">üîß –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</option>
                    <option value="PARENT_NOTIFICATIONS">üë™ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –±–∞—Ç—å–∫–∞–º</option>
                    <option value="HOLIDAY_REMINDERS">üéâ –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ —Å–≤—è—Ç–∞</option>
                    <option value="BACKUP_REMINDER">üíæ –†–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó</option>
                    <option value="SYSTEM_HEALTH">üè• –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="statusFilter" class="form-label">–°—Ç–∞—Ç—É—Å:</label>
                <select class="form-select" id="statusFilter">
                    <option value="">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
                    <option value="enabled">–£–≤—ñ–º–∫–Ω–µ–Ω—ñ</option>
                    <option value="disabled">–í–∏–º–∫–Ω–µ–Ω—ñ</option>
                </select>
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <button class="btn btn-outline-secondary me-2" onclick="loadAutomations()">
                    <i class="bi bi-arrow-clockwise"></i> –û–Ω–æ–≤–∏—Ç–∏
                </button>
                <button class="btn btn-outline-info" onclick="showAutomationHelp()">
                    <i class="bi bi-question-circle"></i> –î–æ–≤—ñ–¥–∫–∞
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">ü§ñ –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó</h5>
    </div>
    <div class="card-body">
        <div id="automationsLoading" class="text-center py-4">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
            </div>
            <p class="mt-2">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π...</p>
        </div>
        
        <div id="automationsTable" style="display: none;">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>–ù–∞–∑–≤–∞</th>
                            <th>–¢–∏–ø</th>
                            <th>–†–æ–∑–∫–ª–∞–¥</th>
                            <th>–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–û—Å—Ç–∞–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∞</th>
                            <th>–î—ñ—ó</th>
                        </tr>
                    </thead>
                    <tbody id="automationsTableBody">
                        <!-- –î–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="noAutomations" style="display: none;" class="text-center py-4">
            <i class="bi bi-robot display-1 text-muted"></i>
            <h4 class="text-muted">–ù–µ–º–∞—î –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π</h4>
            <p class="text-muted">–î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à—É –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—é –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</p>
            <button class="btn btn-primary" onclick="openAddAutomationModal()">
                <i class="bi bi-plus-circle"></i> –î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—é
            </button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è/—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó -->
<div class="modal fade" id="automationModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="automationModalTitle">–î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—é</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="automationForm">
                    <input type="hidden" id="automationId" value="">
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="automationName" class="form-label">–ù–∞–∑–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó *</label>
                                <input type="text" class="form-control" id="automationName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="automationType" class="form-label">–¢–∏–ø –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó *</label>
                                <select class="form-select" id="automationType" required>
                                    <option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø</option>
                                    <!-- –û–ø—Ü—ñ—ó –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="automationDescription" class="form-label">–û–ø–∏—Å</label>
                        <textarea class="form-control" id="automationDescription" rows="2"></textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="adminChatId" class="form-label">Telegram Chat ID –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ *</label>
                                <input type="number" class="form-control" id="adminChatId" required>
                                <div class="form-text">ID —á–∞—Ç—É –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <div class="form-check form-switch mt-4">
                                    <input class="form-check-input" type="checkbox" id="isEnabled" checked>
                                    <label class="form-check-label" for="isEnabled">
                                        –£–≤—ñ–º–∫–Ω–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —á–∞—Å—É (–ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –¥–ª—è –ø–µ–≤–Ω–∏—Ö —Ç–∏–ø—ñ–≤) -->
                    <div id="timeSettings" style="display: none;">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="triggerTime" class="form-label">
                                        <i class="bi bi-clock"></i> –ß–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
                                    </label>
                                    <input type="time" class="form-control" id="triggerTime">
                                    <div class="form-text">
                                        <i class="bi bi-info-circle"></i> 
                                        –ú–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ —á–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –¥–ª—è –∫–æ–∂–Ω–æ—ó –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–æ
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6" id="daySettings" style="display: none;">
                                <div class="mb-3">
                                    <label for="triggerDay" class="form-label">–î–µ–Ω—å —Ç–∏–∂–Ω—è</label>
                                    <select class="form-select" id="triggerDay">
                                        <option value="">–ù–µ –≤–∫–∞–∑–∞–Ω–æ</option>
                                        <option value="0">–ü–æ–Ω–µ–¥—ñ–ª–æ–∫</option>
                                        <option value="1">–í—ñ–≤—Ç–æ—Ä–æ–∫</option>
                                        <option value="2">–°–µ—Ä–µ–¥–∞</option>
                                        <option value="3">–ß–µ—Ç–≤–µ—Ä</option>
                                        <option value="4">–ü'—è—Ç–Ω–∏—Ü—è</option>
                                        <option value="5">–°—É–±–æ—Ç–∞</option>
                                        <option value="6">–ù–µ–¥—ñ–ª—è</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -->
                    <div id="additionalSettings">
                        <!-- –î–∏–Ω–∞–º—ñ—á–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–∏–ø—É -->
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button type="button" class="btn btn-primary" onclick="saveAutomation()">
                    <i class="bi bi-check-lg"></i> –ó–±–µ—Ä–µ–≥—Ç–∏
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ª–æ–≥—ñ–≤ -->
<div class="modal fade" id="logsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">üìä –õ–æ–≥–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="logsContent">
                    <!-- –õ–æ–≥–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–æ–≤—ñ–¥–∫–∏ -->
<div class="modal fade" id="helpModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ü§ñ –î–æ–≤—ñ–¥–∫–∞ –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è–º</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>üì± –¢–∏–ø–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π:</h6>
                <ul>
                    <li><strong>–í—ñ–¥—Å—É—Ç–Ω—ñ —Å—Ç—É–¥–µ–Ω—Ç–∏</strong> - –ü–æ–≤—ñ–¥–æ–º–ª—è—î –ø—Ä–æ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤, —è–∫—ñ –Ω–µ –∑'—è–≤–∏–ª–∏—Å—å –Ω–∞ –∑–∞–Ω—è—Ç—Ç—è –∑ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –±–∞—Ç—å–∫—ñ–≤</li>
                    <li><strong>–î–Ω—ñ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</strong> - –ù–∞–≥–∞–¥—É—î –ø—Ä–æ –¥–Ω—ñ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤, —è–∫—ñ –º–∞—é—Ç—å —É—Ä–æ–∫–∏ —Å—å–æ–≥–æ–¥–Ω—ñ (12:00)</li>
                    <li><strong>–¢–∏–∂–Ω–µ–≤–∏–π –∑–≤—ñ—Ç</strong> - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î –∑–≤—ñ—Ç –ø–æ –≤—Å—ñ–º –≥—É—Ä—Ç–∫–∞–º —Ç–∞ –≤—á–∏—Ç–µ–ª—è–º —É –ø'—è—Ç–Ω–∏—Ü—é (19:00)</li>
                    <li><strong>–©–æ–¥–µ–Ω–Ω–µ –ø—ñ–¥—Å—É–º—É–≤–∞–Ω–Ω—è</strong> - –ü—ñ–¥—Å—É–º–æ–∫ –¥–Ω—è –∑ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–º–∏ —É—Ä–æ–∫–∞–º–∏ —Ç–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—é</li>
                    <li><strong>–ù–∏–∑—å–∫–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å</strong> - –ü–æ–≤—ñ–¥–æ–º–ª—è—î –ø—Ä–æ –≥—É—Ä—Ç–∫–∏ –∑ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—é –º–µ–Ω—à–µ 70%</li>
                    <li><strong>–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ –∑–∞—Ä–ø–ª–∞—Ç–∏</strong> - –ù–∞–≥–∞–¥—É—î –ø—Ä–æ –Ω–µ–ø—Ä–æ–≤–µ–¥–µ–Ω—ñ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –∑–∞—Ä–ø–ª–∞—Ç</li>
                </ul>
                
                <h6>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:</h6>
                <ul>
                    <li><strong>Telegram Chat ID</strong> - –æ—Ç—Ä–∏–º–∞–π—Ç–µ —É –±–æ—Ç—ñ @userinfobot</li>
                    <li><strong>–ß–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–∫–∏</strong> - —É —Ñ–æ—Ä–º–∞—Ç—ñ –ì–ì:–•–• (24-–≥–æ–¥–∏–Ω–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç)</li>
                    <li><strong>–î–µ–Ω—å —Ç–∏–∂–Ω—è</strong> - –¥–ª—è —Ç–∏–∂–Ω–µ–≤–∏—Ö –∑–≤—ñ—Ç—ñ–≤ (0 = –ü–æ–Ω–µ–¥—ñ–ª–æ–∫, 6 = –ù–µ–¥—ñ–ª—è)</li>
                </ul>
                
                <h6>üîß –ö–µ—Ä—É–≤–∞–Ω–Ω—è:</h6>
                <ul>
                    <li>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø–µ—Ä–µ–º–∏–∫–∞—á –¥–ª—è —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è/–≤–∏–º–∫–Ω–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó</li>
                    <li>–ü–µ—Ä–µ–≥–ª—è–¥–∞–π—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º</li>
                    <li>–†–µ–¥–∞–≥—É–π—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –ø–æ—Ç—Ä–µ–±–æ—é</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
let currentAutomations = [];
let automationTypes = [];

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
document.addEventListener('DOMContentLoaded', function() {
    loadAutomationTypes();
    loadAutomations();
    loadTelegramAdmins();  // –î–æ–¥–∞—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤
    
    // –û–±—Ä–æ–±–Ω–∏–∫–∏ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
    document.getElementById('typeFilter').addEventListener('change', loadAutomations);
    document.getElementById('statusFilter').addEventListener('change', loadAutomations);
});

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∏–ø—ñ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π
async function loadAutomationTypes() {
    try {
        const response = await fetch('/api/automations/types/available');
        const data = await response.json();
        automationTypes = data.automation_types;
        
        // –ó–∞–ø–æ–≤–Ω—é—î–º–æ select —É –º–æ–¥–∞–ª—ñ
        const select = document.getElementById('automationType');
        select.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø</option>';
        
        automationTypes.forEach(type => {
            const option = document.createElement('option');
            option.value = type.type;
            option.textContent = type.name;
            option.setAttribute('data-description', type.description);
            option.setAttribute('data-requires-time', type.requires_time);
            option.setAttribute('data-requires-day', type.requires_day);
            select.appendChild(option);
        });
        
        // –û–±—Ä–æ–±–Ω–∏–∫ –∑–º—ñ–Ω–∏ —Ç–∏–ø—É
        select.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            updateTypeSettings(selectedOption);
        });
        
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∏–ø—ñ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π:', error);
    }
}

// –û–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ —Ç–∏–ø—É
function updateTypeSettings(selectedOption) {
    const timeSettings = document.getElementById('timeSettings');
    const daySettings = document.getElementById('daySettings');
    
    if (selectedOption.value) {
        const requiresTime = selectedOption.getAttribute('data-requires-time') === 'true';
        const requiresDay = selectedOption.getAttribute('data-requires-day') === 'true';
        
        if (requiresTime) {
            timeSettings.style.display = 'block';
            
            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –¥–µ—Ñ–æ–ª—Ç–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ —Ç–∏–ø—ñ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π
            const triggerTimeInput = document.getElementById('triggerTime');
            const defaultTime = selectedOption.getAttribute('data-default-time');
            const defaultDay = selectedOption.getAttribute('data-default-day');
            
            if (defaultTime && !triggerTimeInput.value) {
                triggerTimeInput.value = defaultTime.substring(0, 5); // HH:MM
            }
            
            if (defaultDay && requiresDay) {
                document.getElementById('triggerDay').value = defaultDay;
            }
            
            if (requiresDay) {
                daySettings.style.display = 'block';
            } else {
                daySettings.style.display = 'none';
                document.getElementById('triggerDay').value = '';
            }
        } else {
            timeSettings.style.display = 'none';
            document.getElementById('triggerTime').value = '';
            document.getElementById('triggerDay').value = '';
        }
    } else {
        timeSettings.style.display = 'none';
    }
}

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π
async function loadAutomations() {
    try {
        document.getElementById('automationsLoading').style.display = 'block';
        document.getElementById('automationsTable').style.display = 'none';
        document.getElementById('noAutomations').style.display = 'none';
        
        const typeFilter = document.getElementById('typeFilter').value;
        const statusFilter = document.getElementById('statusFilter').value;
        
        let url = '/api/automations';
        const params = new URLSearchParams();
        
        if (statusFilter === 'enabled') {
            params.append('enabled_only', 'true');
        }
        
        if (params.toString()) {
            url += '?' + params.toString();
        }
        
        const response = await fetch(url);
        const automations = await response.json();
        
        // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –ø–æ —Ç–∏–ø—É –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ
        currentAutomations = automations.filter(automation => {
            if (typeFilter && automation.automation_type !== typeFilter) {
                return false;
            }
            if (statusFilter === 'enabled' && !automation.is_enabled) {
                return false;
            }
            if (statusFilter === 'disabled' && automation.is_enabled) {
                return false;
            }
            return true;
        });
        
        displayAutomations(currentAutomations);
        updateStatistics(automations);
        
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π:', error);
        document.getElementById('automationsLoading').style.display = 'none';
        document.getElementById('noAutomations').style.display = 'block';
    }
}

// –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π
function displayAutomations(automations) {
    document.getElementById('automationsLoading').style.display = 'none';
    
    if (automations.length === 0) {
        document.getElementById('noAutomations').style.display = 'block';
        document.getElementById('automationsTable').style.display = 'none';
        return;
    }
    
    document.getElementById('automationsTable').style.display = 'block';
    document.getElementById('noAutomations').style.display = 'none';
    
    const tbody = document.getElementById('automationsTableBody');
    tbody.innerHTML = '';
    
    automations.forEach(automation => {
        const row = createAutomationRow(automation);
        tbody.appendChild(row);
    });
}

// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä—è–¥–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó
function createAutomationRow(automation) {
    const row = document.createElement('tr');
    
    // –ù–∞–∑–≤–∞ —Ç–∞ –æ–ø–∏—Å
    const nameCell = document.createElement('td');
    nameCell.innerHTML = `
        <strong>${automation.name}</strong>
        ${automation.description ? `<br><small class="text-muted">${automation.description}</small>` : ''}
    `;
    
    // –¢–∏–ø
    const typeCell = document.createElement('td');
    const type = automationTypes.find(t => t.type === automation.automation_type);
    typeCell.innerHTML = `
        <span class="badge bg-info">${type ? type.name : automation.automation_type}</span>
    `;
    
    // –†–æ–∑–∫–ª–∞–¥
    const scheduleCell = document.createElement('td');
    let scheduleText = '-';
    if (automation.trigger_time) {
        scheduleText = automation.trigger_time.substring(0, 5); // HH:MM
        if (automation.trigger_day !== null) {
            const days = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–ù–¥'];
            scheduleText += ` (${days[automation.trigger_day]})`;
        }
    }
    scheduleCell.textContent = scheduleText;
    
    // –°—Ç–∞—Ç—É—Å
    const statusCell = document.createElement('td');
    statusCell.innerHTML = automation.is_enabled 
        ? '<span class="badge bg-success">–£–≤—ñ–º–∫–Ω–µ–Ω–æ</span>'
        : '<span class="badge bg-secondary">–í–∏–º–∫–Ω–µ–Ω–æ</span>';
    
    // –û—Å—Ç–∞–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∞
    const lastTriggeredCell = document.createElement('td');
    if (automation.last_triggered) {
        const date = new Date(automation.last_triggered);
        lastTriggeredCell.innerHTML = `
            <small>${date.toLocaleDateString('uk-UA')}<br>${date.toLocaleTimeString('uk-UA', {hour: '2-digit', minute: '2-digit'})}</small>
        `;
    } else {
        lastTriggeredCell.innerHTML = '<small class="text-muted">–ù—ñ–∫–æ–ª–∏</small>';
    }
    
    // –î—ñ—ó
    const actionsCell = document.createElement('td');
    actionsCell.innerHTML = `
        <div class="btn-group btn-group-sm">
            <button class="btn btn-outline-primary" onclick="editAutomation(${automation.id})" title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">
                <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-outline-${automation.is_enabled ? 'warning' : 'success'}" 
                    onclick="toggleAutomation(${automation.id})" 
                    title="${automation.is_enabled ? '–í–∏–º–∫–Ω—É—Ç–∏' : '–£–≤—ñ–º–∫–Ω—É—Ç–∏'}">
                <i class="bi bi-${automation.is_enabled ? 'pause' : 'play'}"></i>
            </button>
            <button class="btn btn-outline-info" onclick="showLogs(${automation.id})" title="–õ–æ–≥–∏">
                <i class="bi bi-list-ul"></i>
            </button>
            <button class="btn btn-outline-danger" onclick="deleteAutomation(${automation.id})" title="–í–∏–¥–∞–ª–∏—Ç–∏">
                <i class="bi bi-trash"></i>
            </button>
        </div>
    `;
    
    row.appendChild(nameCell);
    row.appendChild(typeCell);
    row.appendChild(scheduleCell);
    row.appendChild(statusCell);
    row.appendChild(lastTriggeredCell);
    row.appendChild(actionsCell);
    
    return row;
}

// –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function updateStatistics(automations) {
    const activeCount = automations.filter(a => a.is_enabled).length;
    const disabledCount = automations.filter(a => !a.is_enabled).length;
    
    document.getElementById('activeAutomationsCount').textContent = activeCount;
    document.getElementById('disabledAutomationsCount').textContent = disabledCount;
    document.getElementById('todayExecutionsCount').textContent = '-'; // TODO: —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –∑ –ª–æ–≥—ñ–≤
}

// –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—ñ –¥–æ–¥–∞–≤–∞–Ω–Ω—è
function openAddAutomationModal() {
    document.getElementById('automationModalTitle').textContent = '–î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—é';
    document.getElementById('automationForm').reset();
    document.getElementById('automationId').value = '';
    document.getElementById('isEnabled').checked = true;
    document.getElementById('timeSettings').style.display = 'none';
    document.getElementById('daySettings').style.display = 'none';
    
    const modal = new bootstrap.Modal(document.getElementById('automationModal'));
    modal.show();
}

// –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó
async function editAutomation(id) {
    try {
        const response = await fetch(`/api/automations/${id}`);
        const automation = await response.json();
        
        document.getElementById('automationModalTitle').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—é';
        document.getElementById('automationId').value = automation.id;
        document.getElementById('automationName').value = automation.name;
        document.getElementById('automationType').value = automation.automation_type;
        document.getElementById('automationDescription').value = automation.description || '';
        document.getElementById('adminChatId').value = automation.admin_chat_id;
        document.getElementById('isEnabled').checked = automation.is_enabled;
        
        if (automation.trigger_time) {
            document.getElementById('triggerTime').value = automation.trigger_time.substring(0, 5);
        }
        if (automation.trigger_day !== null) {
            document.getElementById('triggerDay').value = automation.trigger_day;
        }
        
        // –û–Ω–æ–≤–ª—é—î–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∏–ø—É
        const selectedOption = document.getElementById('automationType').options[document.getElementById('automationType').selectedIndex];
        updateTypeSettings(selectedOption);
        
        const modal = new bootstrap.Modal(document.getElementById('automationModal'));
        modal.show();
        
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó:', error);
        alert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó');
    }
}

// –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó
async function saveAutomation() {
    try {
        const formData = {
            name: document.getElementById('automationName').value,
            description: document.getElementById('automationDescription').value,
            automation_type: document.getElementById('automationType').value,
            admin_chat_id: parseInt(document.getElementById('adminChatId').value),
            is_enabled: document.getElementById('isEnabled').checked
        };
        
        const triggerTime = document.getElementById('triggerTime').value;
        if (triggerTime) {
            formData.trigger_time = triggerTime + ':00';
        }
        
        const triggerDay = document.getElementById('triggerDay').value;
        if (triggerDay !== '') {
            formData.trigger_day = parseInt(triggerDay);
        }
        
        const automationId = document.getElementById('automationId').value;
        let url = '/api/automations';
        let method = 'POST';
        
        if (automationId) {
            url += `/${automationId}`;
            method = 'PUT';
        }
        
        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            const modal = bootstrap.Modal.getInstance(document.getElementById('automationModal'));
            modal.hide();
            loadAutomations();
        } else {
            const error = await response.json();
            alert('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ' + (error.detail || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
        }
        
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó:', error);
        alert('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó');
    }
}

// –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó
async function toggleAutomation(id) {
    try {
        const response = await fetch(`/api/automations/${id}/toggle`, {
            method: 'POST'
        });
        
        if (response.ok) {
            loadAutomations();
        } else {
            alert('–ü–æ–º–∏–ª–∫–∞ –∑–º—ñ–Ω–∏ —Å—Ç–∞—Ç—É—Å—É –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó');
        }
        
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó:', error);
        alert('–ü–æ–º–∏–ª–∫–∞ –∑–º—ñ–Ω–∏ —Å—Ç–∞—Ç—É—Å—É');
    }
}

// –í–∏–¥–∞–ª–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó
async function deleteAutomation(id) {
    if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—é?')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/automations/${id}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            loadAutomations();
        } else {
            alert('–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó');
        }
        
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó:', error);
        alert('–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è');
    }
}

// –ü–æ–∫–∞–∑ –ª–æ–≥—ñ–≤
async function showLogs(id) {
    try {
        const response = await fetch(`/api/automations/${id}/logs`);
        const logs = await response.json();
        
        const logsContent = document.getElementById('logsContent');
        
        if (logs.length === 0) {
            logsContent.innerHTML = '<p class="text-muted text-center">–ù–µ–º–∞—î –ª–æ–≥—ñ–≤ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è</p>';
        } else {
            let html = '<div class="table-responsive"><table class="table table-sm">';
            html += '<thead><tr><th>–ß–∞—Å</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</th><th>–ú–µ—Ç—Ä–∏–∫–∏</th></tr></thead><tbody>';
            
            logs.forEach(log => {
                const date = new Date(log.triggered_at);
                const statusBadge = log.status === 'SUCCESS' 
                    ? '<span class="badge bg-success">–£—Å–ø—ñ—Ö</span>'
                    : '<span class="badge bg-danger">–ü–æ–º–∏–ª–∫–∞</span>';
                
                const metrics = [];
                if (log.students_count) metrics.push(`üë• ${log.students_count}`);
                if (log.clubs_count) metrics.push(`üéØ ${log.clubs_count}`);
                if (log.execution_time_ms) metrics.push(`‚è±Ô∏è ${log.execution_time_ms}ms`);
                
                html += `
                    <tr>
                        <td><small>${date.toLocaleString('uk-UA')}</small></td>
                        <td>${statusBadge}</td>
                        <td><small>${log.message || '-'}</small></td>
                        <td><small>${metrics.join(' ')}</small></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            logsContent.innerHTML = html;
        }
        
        const modal = new bootstrap.Modal(document.getElementById('logsModal'));
        modal.show();
        
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª–æ–≥—ñ–≤:', error);
        alert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª–æ–≥—ñ–≤');
    }
}

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Telegram –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤
async function loadTelegramAdmins() {
    try {
        document.getElementById('telegramAdminsLoading').style.display = 'block';
        document.getElementById('telegramAdminsContent').style.display = 'none';
        document.getElementById('noTelegramAdmins').style.display = 'none';
        
        const response = await fetch('/api/automations/admins');
        if (!response.ok) {
            throw new Error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤');
        }
        
        const data = await response.json();
        const admins = data.admins || [];
        
        document.getElementById('telegramAdminsLoading').style.display = 'none';
        
        if (admins.length === 0) {
            document.getElementById('noTelegramAdmins').style.display = 'block';
            document.getElementById('telegramAdminsCount').textContent = '0';
        } else {
            document.getElementById('telegramAdminsContent').style.display = 'block';
            displayTelegramAdmins(admins);
            document.getElementById('telegramAdminsCount').textContent = admins.length;
        }
        
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Telegram –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤:', error);
        document.getElementById('telegramAdminsLoading').style.display = 'none';
        document.getElementById('noTelegramAdmins').style.display = 'block';
        document.getElementById('telegramAdminsCount').textContent = '0';
    }
}

// –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è Telegram –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤
function displayTelegramAdmins(admins) {
    const row = document.getElementById('telegramAdminsRow');
    row.innerHTML = '';
    
    admins.forEach(admin => {
        const col = document.createElement('div');
        col.className = 'col-md-6 mb-3';
        
        col.innerHTML = `
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="card-title mb-1">
                                <i class="bi bi-person-circle text-primary"></i> 
                                ${admin.name}
                            </h6>
                            <small class="text-muted">ID: ${admin.chat_id}</small>
                            ${admin.username ? `<br><small class="text-muted">@${admin.username}</small>` : ''}
                        </div>
                        <div class="text-end">
                            <span class="badge ${admin.is_teacher ? 'bg-success' : 'bg-primary'}">
                                ${admin.is_teacher ? '–í—á–∏—Ç–µ–ª—å' : '–ê–¥–º—ñ–Ω'}
                            </span>
                        </div>
                    </div>
                    <hr class="my-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            <i class="bi bi-robot"></i> 
                            –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π: <strong>${admin.automations_count}</strong>
                        </small>
                        <button class="btn btn-outline-primary btn-sm" 
                                onclick="createAutomationForAdmin(${admin.chat_id})" 
                                title="–î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—é –¥–ª—è —Ü—å–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
                            <i class="bi bi-plus"></i>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        row.appendChild(col);
    });
}

// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
function createAutomationForAdmin(chatId) {
    // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó
    openAddAutomationModal();
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ chat_id –≤ —Ñ–æ—Ä–º—ñ
    setTimeout(() => {
        const chatIdInput = document.getElementById('adminChatId');
        if (chatIdInput) {
            chatIdInput.value = chatId;
        }
    }, 100);
}

// –ü–æ–∫–∞–∑ –¥–æ–≤—ñ–¥–∫–∏
function showAutomationHelp() {
    const modal = new bootstrap.Modal(document.getElementById('helpModal'));
    modal.show();
}
</script>

{% endblock %}
