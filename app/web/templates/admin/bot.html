{% extends "base.html" %}

{% block content %}
<!-- –î–æ–¥–∞—î–º–æ –≤—ñ–¥—Å—Ç—É–ø –∑–≤–µ—Ä—Ö—É –∑–∞–º—ñ—Å—Ç—å –ø–æ–¥–≤—ñ–π–Ω–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ -->
<div class="mt-4 pt-3"></div>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>üì± –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è TG –ë–æ—Ç–æ–º</h2>
    <button type="button" class="btn btn-primary" onclick="openAddBotScheduleModal()">
        <i class="bi bi-plus-circle"></i> –î–æ–¥–∞—Ç–∏ —Ä–æ–∑—Å–∏–ª–∫—É
    </button>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title text-primary">–ê–∫—Ç–∏–≤–Ω–∏—Ö —Ä–æ–∑—Å–∏–ª–æ–∫</h5>
                <h3 id="activeCount" class="text-success">-</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title text-primary">–í–∏–º–∫–Ω–µ–Ω–∏—Ö</h5>
                <h3 id="disabledCount" class="text-warning">-</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title text-primary">–í—Å—å–æ–≥–æ —Ä–æ–∑–∫–ª–∞–¥—ñ–≤</h5>
                <h3 id="totalSchedules" class="text-info">-</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title text-primary">–ë–µ–∑ —Ä–æ–∑—Å–∏–ª–æ–∫</h5>
                <h3 id="withoutBotCount" class="text-muted">-</h3>
            </div>
        </div>
    </div>
</div>

<!-- –§—ñ–ª—å—Ç—Ä–∏ -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row">
            <div class="col-md-3">
                <label for="filterStatus" class="form-label">–°—Ç–∞—Ç—É—Å</label>
                <select class="form-select" id="filterStatus" onchange="filterBotSchedules()">
                    <option value="">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
                    <option value="enabled">–ê–∫—Ç–∏–≤–Ω—ñ</option>
                    <option value="disabled">–í–∏–º–∫–Ω–µ–Ω—ñ</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="filterClub" class="form-label">–ì—É—Ä—Ç–æ–∫</label>
                <select class="form-select" id="filterClub" onchange="filterBotSchedules()">
                    <option value="">–í—Å—ñ –≥—É—Ä—Ç–∫–∏</option>
                    <!-- –ó–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                </select>
            </div>
            <div class="col-md-3">
                <label for="filterTeacher" class="form-label">–í—á–∏—Ç–µ–ª—å</label>
                <select class="form-select" id="filterTeacher" onchange="filterBotSchedules()">
                    <option value="">–í—Å—ñ –≤—á–∏—Ç–µ–ª—ñ</option>
                    <!-- –ó–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                </select>
            </div>
            <div class="col-md-3">
                <label for="filterWeekday" class="form-label">–î–µ–Ω—å —Ç–∏–∂–Ω—è</label>
                <select class="form-select" id="filterWeekday" onchange="filterBotSchedules()">
                    <option value="">–í—Å—ñ –¥–Ω—ñ</option>
                    <option value="1">–ü–æ–Ω–µ–¥—ñ–ª–æ–∫</option>
                    <option value="2">–í—ñ–≤—Ç–æ—Ä–æ–∫</option>
                    <option value="3">–°–µ—Ä–µ–¥–∞</option>
                    <option value="4">–ß–µ—Ç–≤–µ—Ä</option>
                    <option value="5">–ü'—è—Ç–Ω–∏—Ü—è</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü—è —Ä–æ–∑—Å–∏–ª–æ–∫ -->
<div class="card shadow">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover" id="botSchedulesTable">
                <thead>
                    <tr>
                        <th>–ì—É—Ä—Ç–æ–∫</th>
                        <th>–í—á–∏—Ç–µ–ª—å</th>
                        <th>–î–µ–Ω—å / –ß–∞—Å</th>
                        <th>–ì—Ä—É–ø–∞</th>
                        <th>–ß–∞—Å —Ä–æ–∑—Å–∏–ª–∫–∏</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î—ñ—ó</th>
                    </tr>
                </thead>
                <tbody id="botSchedulesTableBody">
                    <!-- –ó–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add Bot Schedule Modal -->
<div class="modal fade" id="addBotScheduleModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–î–æ–¥–∞—Ç–∏ —Ä–æ–∑—Å–∏–ª–∫—É –±–æ—Ç—É</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addBotScheduleForm">
                    <div class="mb-3">
                        <label for="scheduleSelect" class="form-label">–†–æ–∑–∫–ª–∞–¥ *</label>
                        <select class="form-select" id="scheduleSelect" name="scheduleId" required>
                            <option value="">–û–±–µ—Ä—ñ—Ç—å —Ä–æ–∑–∫–ª–∞–¥</option>
                            <!-- –ó–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–ß–∞—Å —Ä–æ–∑—Å–∏–ª–∫–∏</label>
                        
                        <div class="mb-2">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="timeMode" id="offsetMode" value="offset" checked onchange="toggleTimeMode()">
                                <label class="form-check-label" for="offsetMode">
                                    –í—ñ–¥–Ω–æ—Å–Ω–æ –ø–æ—á–∞—Ç–∫—É –∑–∞–Ω—è—Ç—Ç—è
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="timeMode" id="exactMode" value="exact" onchange="toggleTimeMode()">
                                <label class="form-check-label" for="exactMode">
                                    –¢–æ—á–Ω–∏–π —á–∞—Å
                                </label>
                            </div>
                        </div>
                        
                        <div id="offsetSection">
                            <div class="row">
                                <div class="col-md-6">
                                    <select class="form-select" id="offsetMinutes" name="offsetMinutes">
                                        <option value="-15">–ó–∞ 15 —Ö–≤ –¥–æ –ø–æ—á–∞—Ç–∫—É</option>
                                        <option value="-10">–ó–∞ 10 —Ö–≤ –¥–æ –ø–æ—á–∞—Ç–∫—É</option>
                                        <option value="-5">–ó–∞ 5 —Ö–≤ –¥–æ –ø–æ—á–∞—Ç–∫—É</option>
                                        <option value="0" selected>–ù–∞ –ø–æ—á–∞—Ç–∫—É –∑–∞–Ω—è—Ç—Ç—è</option>
                                        <option value="5">–ß–µ—Ä–µ–∑ 5 —Ö–≤ –ø—ñ—Å–ª—è –ø–æ—á–∞—Ç–∫—É</option>
                                        <option value="10">–ß–µ—Ä–µ–∑ 10 —Ö–≤ –ø—ñ—Å–ª—è –ø–æ—á–∞—Ç–∫—É</option>
                                        <option value="15">–ß–µ—Ä–µ–∑ 15 —Ö–≤ –ø—ñ—Å–ª—è –ø–æ—á–∞—Ç–∫—É</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <input type="number" class="form-control" id="customOffset" placeholder="–ê–±–æ –≤–∫–∞–∂—ñ—Ç—å —Ö–≤–∏–ª–∏–Ω–∏" 
                                           onchange="updateOffsetSelect()">
                                    <small class="form-text text-muted">–ù–µ–≥–∞—Ç–∏–≤–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è = –¥–æ –ø–æ—á–∞—Ç–∫—É</small>
                                </div>
                            </div>
                        </div>
                        
                        <div id="exactTimeSection" style="display: none;">
                            <input type="time" class="form-control" id="customTime" name="customTime">
                            <small class="form-text text-muted">–†–æ–∑—Å–∏–ª–∫–∞ –±—É–¥–µ –æ —Ü—å–æ–º—É —á–∞—Å—ñ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø–æ—á–∞—Ç–∫—É –∑–∞–Ω—è—Ç—Ç—è</small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="customMessage" class="form-label">–ö–∞—Å—Ç–æ–º–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <textarea class="form-control" id="customMessage" name="customMessage" rows="3" 
                                  placeholder="–ó–∞–ª–∏—à—Ç–µ –ø–æ—Ä–æ–∂–Ω—ñ–º –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="enabledCheck" name="enabled" checked>
                            <label class="form-check-label" for="enabledCheck">
                                –ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Ä–æ–∑—Å–∏–ª–∫—É –æ–¥—Ä–∞–∑—É
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button type="button" class="btn btn-primary" onclick="saveBotSchedule()">–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–æ–∑—Å–∏–ª–∫—É</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Bot Schedule Modal -->
<div class="modal fade" id="editBotScheduleModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ä–æ–∑—Å–∏–ª–∫—É –±–æ—Ç—É</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editBotScheduleForm">
                    <input type="hidden" id="editBotScheduleId">
                    
                    <div class="mb-3">
                        <label class="form-label">–†–æ–∑–∫–ª–∞–¥</label>
                        <div id="scheduleInfo" class="form-control-plaintext bg-light p-2 rounded">
                            <!-- –ó–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–ß–∞—Å —Ä–æ–∑—Å–∏–ª–∫–∏</label>
                        
                        <div class="mb-2">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="editTimeMode" id="editOffsetMode" value="offset" checked onchange="toggleEditTimeMode()">
                                <label class="form-check-label" for="editOffsetMode">
                                    –í—ñ–¥–Ω–æ—Å–Ω–æ –ø–æ—á–∞—Ç–∫—É –∑–∞–Ω—è—Ç—Ç—è
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="editTimeMode" id="editExactMode" value="exact" onchange="toggleEditTimeMode()">
                                <label class="form-check-label" for="editExactMode">
                                    –¢–æ—á–Ω–∏–π —á–∞—Å
                                </label>
                            </div>
                        </div>
                        
                        <div id="editOffsetSection">
                            <div class="row">
                                <div class="col-md-6">
                                    <select class="form-select" id="editOffsetMinutes" name="offsetMinutes">
                                        <option value="-15">–ó–∞ 15 —Ö–≤ –¥–æ –ø–æ—á–∞—Ç–∫—É</option>
                                        <option value="-10">–ó–∞ 10 —Ö–≤ –¥–æ –ø–æ—á–∞—Ç–∫—É</option>
                                        <option value="-5">–ó–∞ 5 —Ö–≤ –¥–æ –ø–æ—á–∞—Ç–∫—É</option>
                                        <option value="0">–ù–∞ –ø–æ—á–∞—Ç–∫—É –∑–∞–Ω—è—Ç—Ç—è</option>
                                        <option value="5">–ß–µ—Ä–µ–∑ 5 —Ö–≤ –ø—ñ—Å–ª—è –ø–æ—á–∞—Ç–∫—É</option>
                                        <option value="10">–ß–µ—Ä–µ–∑ 10 —Ö–≤ –ø—ñ—Å–ª—è –ø–æ—á–∞—Ç–∫—É</option>
                                        <option value="15">–ß–µ—Ä–µ–∑ 15 —Ö–≤ –ø—ñ—Å–ª—è –ø–æ—á–∞—Ç–∫—É</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <input type="number" class="form-control" id="editCustomOffset" placeholder="–ê–±–æ –≤–∫–∞–∂—ñ—Ç—å —Ö–≤–∏–ª–∏–Ω–∏" 
                                           onchange="updateEditOffsetSelect()">
                                    <small class="form-text text-muted">–ù–µ–≥–∞—Ç–∏–≤–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è = –¥–æ –ø–æ—á–∞—Ç–∫—É</small>
                                </div>
                            </div>
                        </div>
                        
                        <div id="editExactTimeSection" style="display: none;">
                            <input type="time" class="form-control" id="editCustomTime" name="customTime">
                            <small class="form-text text-muted">–†–æ–∑—Å–∏–ª–∫–∞ –±—É–¥–µ –æ —Ü—å–æ–º—É —á–∞—Å—ñ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø–æ—á–∞—Ç–∫—É –∑–∞–Ω—è—Ç—Ç—è</small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="editCustomMessage" class="form-label">–ö–∞—Å—Ç–æ–º–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</label>
                        <textarea class="form-control" id="editCustomMessage" name="customMessage" rows="3" 
                                  placeholder="–ó–∞–ª–∏—à—Ç–µ –ø–æ—Ä–æ–∂–Ω—ñ–º –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="editEnabledCheck" name="enabled">
                            <label class="form-check-label" for="editEnabledCheck">
                                –ê–∫—Ç–∏–≤–Ω–∞ —Ä–æ–∑—Å–∏–ª–∫–∞
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button type="button" class="btn btn-primary" onclick="updateBotSchedule()">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- JavaScript —Ñ—É–Ω–∫—Ü—ñ—ó –≤ admin.js -->
{% endblock %}
